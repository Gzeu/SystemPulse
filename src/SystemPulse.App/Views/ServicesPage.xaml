<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SystemPulse.App.Views.ServicesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:toolkit="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:SystemPulse.App.Converters"
    Background="{ThemeResource SolidBackgroundFillColorBase}">

    <Page.Resources>
        <converters:StatusTextConverter x:Key="StatusConverter"/>
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Spacing="8">
                <TextBlock Text="Services" Style="{ThemeResource TitleTextBlockStyle}" FontWeight="SemiBold"/>
                <TextBlock Text="Manage Windows services" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>

            <Button Grid.Column="1" Content="Refresh" Command="{x:Bind ViewModel.RefreshCommand}" VerticalAlignment="Center">
                <Button.Icon>
                    <FontIcon Glyph="&#xE72C;"/>
                </Button.Icon>
            </Button>
        </Grid>

        <!-- Filters -->
        <Grid Grid.Row="1" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="200"/>
            </Grid.ColumnDefinitions>

            <TextBox Grid.Column="0" PlaceholderText="Search services..." Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <TextBox.Icon>
                    <FontIcon Glyph="&#xE721;"/>
                </TextBox.Icon>
            </TextBox>

            <ComboBox Grid.Column="1" SelectedIndex="{x:Bind ViewModel.FilterIndex, Mode=TwoWay}" HorizontalAlignment="Stretch">
                <ComboBoxItem Content="All Services"/>
                <ComboBoxItem Content="Running Only"/>
                <ComboBoxItem Content="Stopped Only"/>
            </ComboBox>
        </Grid>

        <!-- Services DataGrid -->
        <Border Grid.Row="2" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8">
            <toolkit:DataGrid
                ItemsSource="{x:Bind ViewModel.FilteredServices, Mode=OneWay}"
                SelectedItem="{x:Bind ViewModel.SelectedService, Mode=TwoWay}"
                AutoGenerateColumns="False"
                IsReadOnly="True"
                GridLinesVisibility="Horizontal"
                AlternatingRowBackground="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                CanUserSortColumns="True"
                CanUserReorderColumns="True">

                <toolkit:DataGrid.Columns>
                    <toolkit:DataGridTextColumn Header="Service Name" Binding="{Binding DisplayName}" Width="*" MinWidth="200"/>
                    <toolkit:DataGridTextColumn Header="Status" Binding="{Binding Status, Converter={StaticResource StatusConverter}}" Width="100"/>
                    <toolkit:DataGridTextColumn Header="Startup Type" Binding="{Binding StartupType}" Width="120"/>
                    <toolkit:DataGridTextColumn Header="Service" Binding="{Binding ServiceName}" Width="180"/>
                    <toolkit:DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*" MinWidth="250"/>
                </toolkit:DataGrid.Columns>

                <toolkit:DataGrid.ContextFlyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Start" Command="{x:Bind ViewModel.StartServiceCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE768;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem Text="Stop" Command="{x:Bind ViewModel.StopServiceCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE71A;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutItem Text="Restart" Command="{x:Bind ViewModel.RestartServiceCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE777;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                        <MenuFlyoutSeparator/>
                        <MenuFlyoutItem Text="Properties" Command="{x:Bind ViewModel.ShowPropertiesCommand}">
                            <MenuFlyoutItem.Icon>
                                <FontIcon Glyph="&#xE946;"/>
                            </MenuFlyoutItem.Icon>
                        </MenuFlyoutItem>
                    </MenuFlyout>
                </toolkit:DataGrid.ContextFlyout>
            </toolkit:DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8" Padding="16,8">
            <Grid ColumnSpacing="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" FontSize="13">
                    <Run Text="Total: "/>
                    <Run Text="{x:Bind ViewModel.TotalServices, Mode=OneWay}" FontWeight="SemiBold"/>
                </TextBlock>

                <TextBlock Grid.Column="1" FontSize="13">
                    <Run Text="Running: "/>
                    <Run Text="{x:Bind ViewModel.RunningServices, Mode=OneWay}" FontWeight="SemiBold" Foreground="#10B981"/>
                </TextBlock>

                <TextBlock Grid.Column="2" Text="{x:Bind ViewModel.SelectedService.DisplayName, Mode=OneWay}" FontSize="13" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="8">
                    <Button Content="Start" Command="{x:Bind ViewModel.StartServiceCommand}" Style="{ThemeResource AccentButtonStyle}" Height="32" MinWidth="80"/>
                    <Button Content="Stop" Command="{x:Bind ViewModel.StopServiceCommand}" Height="32" MinWidth="80"/>
                    <Button Content="Restart" Command="{x:Bind ViewModel.RestartServiceCommand}" Height="32" MinWidth="80"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
